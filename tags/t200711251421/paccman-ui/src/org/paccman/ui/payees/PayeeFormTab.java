/*
 * PayeeFormTab.java
 *
 * Created on 24 juin 2005, 00:06
 */

package org.paccman.ui.payees;

import java.awt.BorderLayout;
import javax.swing.JOptionPane;
import org.paccman.controller.PayeeController;
import org.paccman.ui.selector.ControllerSelectionListener;
import static org.paccman.ui.main.ContextMain.*;

/**
 *
 * @author  joao
 */
public class PayeeFormTab extends javax.swing.JPanel implements ControllerSelectionListener {
    
    /**
     * Creates new form PayeeFormTab
     */
    public PayeeFormTab() {
        initComponents();
        initMyComponents();
        setEditMode(false);
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        jSplitPane1 = new javax.swing.JSplitPane();
        jThirdPartySelectorPane = new javax.swing.JPanel();
        jEditNewPanel = new javax.swing.JPanel();
        jEditBtn = new javax.swing.JButton();
        jNewBtn = new javax.swing.JButton();
        jThirdPartyFormPane = new javax.swing.JPanel();
        jValidateCancelPanel = new javax.swing.JPanel();
        jValidateBtn = new javax.swing.JButton();
        jCancelBtn = new javax.swing.JButton();

        setLayout(new java.awt.BorderLayout());

        jThirdPartySelectorPane.setLayout(new java.awt.BorderLayout());

        jEditNewPanel.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.RIGHT));

        jEditBtn.setText("Edit");
        jEditBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jEditBtnActionPerformed(evt);
            }
        });

        jEditNewPanel.add(jEditBtn);

        jNewBtn.setText("New");
        jNewBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jNewBtnActionPerformed(evt);
            }
        });

        jEditNewPanel.add(jNewBtn);

        jThirdPartySelectorPane.add(jEditNewPanel, java.awt.BorderLayout.SOUTH);

        jSplitPane1.setLeftComponent(jThirdPartySelectorPane);

        jThirdPartyFormPane.setLayout(new java.awt.BorderLayout());

        jValidateCancelPanel.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.RIGHT));

        jValidateBtn.setText("Validate");
        jValidateBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jValidateBtnActionPerformed(evt);
            }
        });

        jValidateCancelPanel.add(jValidateBtn);

        jCancelBtn.setText("Cancel");
        jCancelBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCancelBtnActionPerformed(evt);
            }
        });

        jValidateCancelPanel.add(jCancelBtn);

        jThirdPartyFormPane.add(jValidateCancelPanel, java.awt.BorderLayout.SOUTH);

        jSplitPane1.setRightComponent(jThirdPartyFormPane);

        add(jSplitPane1, java.awt.BorderLayout.CENTER);

    }
    // </editor-fold>//GEN-END:initComponents

    private void jValidateBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jValidateBtnActionPerformed
        PayeeController validatedThirdParty = null;
        validatedThirdParty = (PayeeController) jThirdPartyFormPanel.onValidate();
        if ( validatedThirdParty != null) {
            setEditMode(false);
            if (validatedThirdParty == selectedThirdParty) {
                // ThirdParty updated
                selectedThirdParty.notifyChange();
            } else {
                // New thirdParty added
                getDocumentController().getDocument().addPayee(validatedThirdParty.getPayee());
                getDocumentController().notifyChange();
                jThirdPartySelectorPanel.selectThirdParty(validatedThirdParty);
            }
        } else {
            JOptionPane.showMessageDialog(this, "Failed to validate", "Validation failed", JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_jValidateBtnActionPerformed

    private void jEditBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jEditBtnActionPerformed
        jThirdPartyFormPanel.onEdit();
        setEditMode(true);
    }//GEN-LAST:event_jEditBtnActionPerformed

    private void jCancelBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCancelBtnActionPerformed
        jThirdPartyFormPanel.onCancel();
        setEditMode(false);
    }//GEN-LAST:event_jCancelBtnActionPerformed

    private void jNewBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jNewBtnActionPerformed
        jThirdPartyFormPanel.onNew();
        setEditMode(true);
    }//GEN-LAST:event_jNewBtnActionPerformed
    
    private boolean editing        ;
    private PayeeController selectedThirdParty;
    
    public void setEditMode(boolean editing) {
        this.editing = editing;
        jEditBtn.setEnabled(!editing && (selectedThirdParty != null)); 
        jNewBtn.setEnabled(!editing);
        jValidateBtn.setEnabled(editing);
        jCancelBtn.setEnabled(editing); 
    }
    
    public void registerToDocumentCtrl() {
        jThirdPartySelectorPanel.registerToDocumentCtrl();
        jThirdPartyFormPanel.registerToDocumentCtrl();
    }
    
    private void initMyComponents() {
        jThirdPartySelectorPanel = new PayeeSelectorPanel();
        jThirdPartySelectorPane.add(jThirdPartySelectorPanel, BorderLayout.NORTH);
        
        jThirdPartyFormPanel    = new PayeeFormPanel();
        jThirdPartyFormPane.add(jThirdPartyFormPanel, BorderLayout.NORTH);
        
        jThirdPartySelectorPanel.addListener(this);
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jCancelBtn;
    private javax.swing.JButton jEditBtn;
    private javax.swing.JPanel jEditNewPanel;
    private javax.swing.JButton jNewBtn;
    private javax.swing.JSplitPane jSplitPane1;
    private javax.swing.JPanel jThirdPartyFormPane;
    private javax.swing.JPanel jThirdPartySelectorPane;
    private javax.swing.JButton jValidateBtn;
    private javax.swing.JPanel jValidateCancelPanel;
    // End of variables declaration//GEN-END:variables
    
    private PayeeSelectorPanel jThirdPartySelectorPanel;
    private PayeeFormPanel     jThirdPartyFormPanel    ;
    
    public void controllerSelected(org.paccman.controller.Controller thirdPartyCtrl) {
        assert( ! editing );
        jThirdPartyFormPanel.onSelect(thirdPartyCtrl);
        selectedThirdParty = (PayeeController)thirdPartyCtrl;
        jEditBtn.setEnabled(true);
    }

    public boolean selectionEnabled() {
        if (editing) JOptionPane.showMessageDialog(this, "SELECTION DISABLE :TODO:"); 
        return ! editing;
    }

}
